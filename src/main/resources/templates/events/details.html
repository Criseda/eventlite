<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/default}"
>
  <head>
    <title>Event Details</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.10.0/mapbox-gl.css" rel="stylesheet">
	  <script src="https://api.mapbox.com/mapbox-gl-js/v3.10.0/mapbox-gl.js"></script>
    <style>
      #map {
        width: 100%;
        height: 50vh;
        min-height: 300px;
        position: relative !important;
        display: block !important;
        visibility: visible !important;
      }
    </style>
  </head>
  <body>
    <div layout:fragment="content">
      <h1>Event Details</h1>

      <table class="table table-striped table-hover">
        <tbody>
          <tr>
            <th width="150em"><i class="fa-solid fa-bolt"></i> Event name</th>
            <td th:text="${e.name}"></td>
          </tr>
          <tr>
            <th><i class="fa-solid fa-calendar"></i> Start date</th>
            <td
              th:text="${e.date.getDayOfMonth()} + '/' + ${e.date.getMonthValue()} + '/' + ${e.date.getYear()}"
            ></td>
          </tr>
          <tr th:if="${e.time != null}">
            <th><i class="fa-solid fa-clock"></i> Start time</th>
            <td th:text="${e.time.toString()}"></td>
          </tr>
          <tr>
            <th><i class="fa-solid fa-map-marker-alt"></i> Venue name</th>
            <td th:text="${e.venue.name}"></td>
          </tr>

          <tr>
            <th><i class="fa-solid fa-person"></i> Venue capacity</th>
            <td th:text="${e.venue.capacity}"></td>
          </tr>
          <tr th:if="${e.description != null and (#strings.trim(e.description).length != 0)}">
            <th><i class="fa-solid fa-circle-info"></i> Description</th>
            <td th:text="${e.description}"></td>
          </tr>
        </tbody>
      </table>

      <div id="map"></div>

      <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function () {

            mapboxgl.accessToken = /*[[${api}]]*/ '';
  
            var longitude = /*[[${e.getVenue().getLongitude()}]]*/ 0;
            var latitude = /*[[${e.getVenue().getLatitude()}]]*/ 0;
  
            console.log("Longitude:", longitude);
            console.log("Latitude:", latitude);
            console.log(mapboxgl.accessToken)
  
            if (longitude !== 0 && latitude !== 0) {
                const map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/streets-v11',
                    center: [longitude, latitude],
                    zoom: 17
                });
  
                new mapboxgl.Marker()
                    .setLngLat([longitude, latitude])
                    .addTo(map);
  
                var bounds = new mapboxgl.LngLatBounds();
                bounds.extend([longitude, latitude]);
                map.fitBounds(bounds, { padding: 50 });
                
                setTimeout(() => {
                    map.resize();
                }, 500);

            } else {
                console.warn("Invalid coordinates");
            }
        });
      </script>
      
      <div class="d-flex justify-content-between mb-3">
        <p>
          <a class="btn btn-secondary" role="button" th:href="@{/events}"
            ><i class="fa-solid fa-arrow-left" aria-hidden="true"></i> Back to
            Events</a
          >
        </p>
        <form
          th:action="@{/events/{id}(id=${e.id})}"
          th:method="delete"
          sec:authorize="hasAnyRole('ORGANIZER', 'ADMIN')"
        >
          <button type="submit" class="btn btn-danger">
            <i class="fa-solid fa-trash" aria-hidden="true"></i> Delete
          </button>
        </form>
      </div>  
    </div> 
  </body>
</html>
