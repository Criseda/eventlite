<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/default}"
>
  <head>
    <title>All events</title>
  </head>
  <body>
    <div layout:fragment="content">
      <h1>All events</h1>

      <!-- Search Form -->
      <form th:action="@{/events}" method="get" class="mb-3">
        <input
          type="text"
          name="search"
          th:value="${search}"
          placeholder="Enter event name to search"
          class="form-control"
        />
        <button type="submit" class="btn btn-primary mt-2">Search</button>
      </form>

      <!-- Create New Event Button (Visible to Organizers) -->
      <div sec:authorize="hasAnyRole('ORGANIZER', 'ADMIN')">
        <a href="/events/new" class="btn btn-secondary">
          <i class="fa-solid fa-arrow-right"></i> Create New Event
        </a>
      </div>

      <!-- Upcoming Events Section -->
	  
      <h2>Upcoming Events</h2>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th><i class="fa-solid fa-bolt"></i> Event</th>
            <th><i class="fa-solid fa-map-marker-alt"></i> Venue</th>
            <th><i class="fa-solid fa-calendar"></i> Date</th>
            <th><i class="fa-solid fa-clock"></i> Time</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="e : ${upcomingEvents}">
            <td th:text="${e.name}">My Event</td>
            <td th:text="${e.venue.name}">Event Venue</td>
            <td th:text="${{e.date}}">Event Date</td>
            <td th:text="${{e.time}}">Event Time</td>
            <td >
              <a
                class="btn btn-primary"
                sec:authorize="hasRole('ATTENDEE')"
                role="button"
              >
                <i class="fa-solid fa-circle-info" aria-hidden="true"></i>
                Register
              </a>
              <a
                class="btn btn-primary"
                sec:authorize="hasAnyRole('ORGANIZER', 'ADMIN')"
                role="button"
                th:href="@{/events/update/{id}(id=${e.id})}"
              >
                <i class="fa-solid fa-circle-info" aria-hidden="true"></i>
                Update
              </a>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Previous Events Section -->
	  <div th:if="${previousEvents.size() != 0}">
      <h2>Previous Events</h2>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th><i class="fa-solid fa-bolt"></i> Event</th>
            <th><i class="fa-solid fa-map-marker-alt"></i> Venue</th>
            <th><i class="fa-solid fa-calendar"></i> Date</th>
            <th><i class="fa-solid fa-clock"></i> Time</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="e : ${previousEvents}">
            <td th:text="${e.name}">My Event</td>
            <td th:text="${e.venue.name}">Event Venue</td>
            <td th:text="${{e.date}}">Event Date</td>
            <td th:text="${{e.time}}">Event Time</td>
            <td>
              <a
                class="btn btn-primary"
                role="button"
                th:href="@{/events/{id}(id=${e.id})}"
              >
                <i class="fa-solid fa-circle-info" aria-hidden="true"></i>
                Details
              </a>
              <a
                class="btn btn-primary"
                sec:authorize="hasRole('ATTENDEE')"
                role="button"
                th:href="@{/events/{id}(id=${e.id})}"
              >
                <i class="fa-solid fa-circle-info" aria-hidden="true"></i>
                Register
              </a>
              <a
                class="btn btn-primary"
                sec:authorize="hasAnyRole('ORGANIZER', 'ADMIN')"
                role="button"
                th:href="@{/events/update/{id}(id=${e.id})}"
              >
                <i class="fa-solid fa-circle-info" aria-hidden="true"></i>
                Update
              </a>
            </td>
          </tr>
        </tbody>
      </table>
	  </div>
    </div>
  </body>
</html>
